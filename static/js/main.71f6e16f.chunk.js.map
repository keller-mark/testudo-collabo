{"version":3,"sources":["constants.js","utils.js","TestudoCanvas.js","ItemList.js","App.js","index.js"],"names":["SERVER_URL","WS_URL","HTTP_URL","ITEMS","ITEM_MASK","RUB_MASK","itemToPath","item","sum","previousValue","currentValue","HandSprites","props","arr","width","height","mask","xi","yi","itemSize","itemPath","Array","from","map","count","iMask","iFlat","j","Math","floor","i","log10","alpha","clamp","key","image","x","y","filter","Boolean","DonationSprites","data","range","length","sort","a","b","TestudoCanvas","handState","isPlacing","divRef","useRef","useState","setWidth","setHeight","top","setTop","left","setLeft","setData","rubTotal","setRubTotal","itemTotals","setItemTotals","secondsRemaining","setSecondsRemaining","useEffect","token","PubSub","subscribe","msg","intToItem","subarray","prevData","total","reduce","prevTotals","unsubscribe","resizeHandler","current","getBoundingClientRect","divWidth","divTop","divLeft","window","addEventListener","removeEventListener","setTimeout","oldVal","onPointerDown","useCallback","debounce","event","origEvent","originalEvent","toast","Toaster","create","position","Position","TOP","document","body","show","message","clientX","pageX","clientY","pageY","desktopOffset","isMobile","check","navigator","userAgent","vendor","opera","test","substr","mobileAndTabletCheck","round","itemIndex","indexOf","itemToInt","req","d3_json","method","JSON","stringify","intent","Intent","SUCCESS","leading","cursorStyle","cursor","donationTotal","Object","values","numberFormatter","Intl","NumberFormat","ref","className","style","options","transparent","antialias","resolution","clearBeforeRender","interactive","pointerdown","rubs","minimal","format","value","ItemList","onSelect","Classes","DRAWER_BODY","backgroundImage","onClick","App","setHandState","isPicking","setIsPicking","setItem","socket","WebSocket","send","blob","arrayBuffer","then","buf","Uint16Array","publish","e","fileReader","FileReader","onload","target","result","readAsArrayBuffer","console","log","content","BOTTOM","hoverOpenDelay","large","text","active","href","rightIcon","IconNames","SHARE","CODE","isOpen","onClose","title","lazy","name","alt","src","display","ReactDOM","render","getElementById"],"mappings":"8WAAaA,EAA0E,qDAC1EC,EAAM,eAAWD,GACjBE,EAAQ,iBAAaF,GAYrBG,EAAQ,CACjB,QACA,QACA,QACA,SACA,MACA,UACA,OACA,UACA,KACA,QACA,UACA,OACA,SACA,OACA,QACA,OACA,YACA,OACA,SACA,QACA,OACA,WACA,QAGSC,EAAY,CAAC,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,MAEpmFC,EAAW,CAAC,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IA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","file":"static/js/main.71f6e16f.chunk.js","sourcesContent":["export const SERVER_URL = (process.env.NODE_ENV === \"development\" ? \"localhost:8000\" : \"ec2-18-216-190-253.us-east-2.compute.amazonaws.com\");\nexport const WS_URL = `ws://${SERVER_URL}`;\nexport const HTTP_URL = `http://${SERVER_URL}`;\n\nexport const AR = 1674/935; // aspect ratio\nexport const GRID_WIDTH = 50;\nexport const GRID_HEIGHT = 28;\nexport const GRID_SIZE = GRID_WIDTH*GRID_HEIGHT;\nexport const TIME_LIMIT = 2;\n\nexport const HAND_PLACING = \"placing\";\nexport const HAND_RUBBING = \"rubbing\";\nexport const EVENT_LOAD = \"load\";\n\nexport const ITEMS = [\n    \"pepsi\",\n    \"chips\",\n    \"candy\",\n    \"coffee\",\n    \"can\",\n    \"chicken\",\n    \"gyro\",\n    \"noodles\",\n    \"vr\",\n    \"scoot\",\n    \"seltzer\",\n    \"wine\",\n    \"bottle\",\n    \"pool\",\n    \"brick\",\n    \"cone\",\n    \"bluelight\",\n    \"door\",\n    \"toilet\",\n    \"piano\",\n    \"sign\",\n    \"squirrel\",\n    \"fire\",\n];\n\nexport const ITEM_MASK = [300,301,302,303,304,305,306,307,308,309,310,348,349,350,351,352,353,354,355,356,357,358,398,399,400,401,402,403,404,405,406,407,447,448,449,450,451,452,453,454,455,456,496,497,498,499,500,501,502,503,504,505,544,545,546,547,548,549,550,551,552,553,554,591,592,593,594,595,596,597,598,599,600,601,602,603,604,640,641,642,643,644,645,646,647,648,649,650,651,652,653,654,689,690,691,692,693,694,695,696,697,698,699,700,701,702,703,704,705,739,740,741,742,743,744,745,746,747,748,749,750,751,752,753,754,755,757,789,790,791,792,793,794,795,796,797,798,799,800,801,802,803,804,805,806,807,808,809,833,834,835,836,838,839,840,841,842,843,844,845,846,847,848,849,850,851,852,853,854,855,856,857,858,859,860,861,862,863,864,881,882,883,884,885,886,887,888,889,890,891,892,893,894,895,896,897,898,899,900,901,902,903,904,905,906,907,908,909,910,911,912,913,914,921,922,923,924,925,926,927,928,929,930,931,932,933,934,935,936,937,938,939,940,941,942,943,944,945,946,947,948,949,950,951,952,953,954,955,956,957,958,959,960,961,962,963,964,965,970,971,972,973,974,975,976,977,978,979,980,981,982,983,984,985,986,987,988,989,990,991,992,993,994,995,996,997,998,999,1000,1001,1002,1003,1004,1005,1006,1007,1008,1009,1010,1011,1012,1013,1014,1015,1016,1017,1018,1019,1020,1021,1022,1023,1024,1025,1026,1027,1028,1029,1030,1031,1032,1033,1034,1035,1036,1037,1038,1039,1040,1041,1042,1043,1044,1045,1046,1047,1048,1049,1050,1051,1052,1053,1054,1055,1056,1057,1058,1059,1060,1061,1062,1063,1064,1065,1066,1067,1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,1078,1079,1080,1081,1082,1083,1084,1085,1086,1087,1088,1089,1090,1091,1092,1093,1094,1095,1096,1097,1098,1099,1100,1101,1102,1103,1104,1105,1106,1107,1108,1109,1110,1111,1112,1113,1114,1115,1116,1117,1118,1119,1120,1121,1122,1123,1124,1125,1126,1127,1128,1129,1130,1131,1132,1133,1134,1135,1136,1137,1138,1139,1140,1141,1142,1143,1144,1145,1146,1147,1148,1149,1150,1151,1152,1153,1154,1155,1156,1157,1158,1159,1160,1161,1162,1163,1164,1165,1166,1167,1168,1169,1170,1171,1172,1173,1174,1175,1176,1177,1178,1179,1180,1181,1182,1183,1184,1185,1186,1187,1188,1189,1190,1191,1192,1193,1194,1195,1196,1197,1198,1199,1200,1201,1202,1203,1204,1205,1206,1207,1208,1209,1210,1211,1212,1213,1214,1215,1216,1217,1218,1219,1220,1221,1222,1223,1224,1225,1226,1227,1228,1229,1230,1231,1232,1233,1234,1235,1236,1237,1238,1239,1240,1241,1242,1243,1244,1245,1246,1247,1248,1249,1250,1251,1252,1253,1254,1255,1256,1257,1258,1259,1260,1261,1262,1263,1264,1265,1266,1267,1268,1269,1270,1271,1272,1273,1274,1275,1276,1277,1278,1279,1280,1281,1282,1283,1284,1285,1286,1287,1288,1289,1290,1291,1292,1293,1294,1295,1296,1297,1298,1299];\n\nexport const RUB_MASK = [74,117,118,119,120,121,122,123,124,125,165,166,167,168,169,170,171,172,173,174,175,176,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,288,289,290,291,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,332,333,334,335,337,338,339,340,341,342,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,506,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522,523,524,525,526,527,528,529,530,531,532,533,534,535,536,537,538,539,540,541,542,556,557,558,559,560,561,562,563,564,565,566,567,568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589,590,591,604,605,606,607,608,609,610,611,612,613,614,615,616,617,618,619,620,621,622,623,624,625,626,627,628,629,630,631,632,633,634,635,636,637,638,639,640,652,653,654,655,656,657,658,659,660,661,662,663,664,665,666,667,668,669,670,671,672,673,674,675,676,677,678,679,680,681,682,683,684,685,686,687,688,689,701,702,703,704,705,706,707,708,709,710,711,712,713,714,715,716,717,718,719,720,721,722,723,724,725,726,727,728,729,730,731,732,733,734,735,736,737,738,751,752,753,754,755,756,757,758,759,760,761,762,763,764,765,766,767,768,769,770,771,772,773,774,775,776,777,778,779,780,781,782,783,784,785,786,787,788,805,806,807,808,809,810,811,812,813,814,815,816,817,818,819,820,821,822,823,824,825,826,827,828,829,830,831,832,833,834,835,836,837,838,839,861,862,863,864,865,866,867,868,869,870,871,872,873,874,875,876,877,878,879,880,881,882,883,886,887,888,889,890,915,916,917,918,919,920,921,922,923,924,925,926,927,928,929,930,931,965,966,967,968,969,970,971,972,1015,1016,1017,1018,1019,1020,1021,1065,1066,1067,1068,1069,1070];","import { ITEMS } from './constants';\n\nexport const itemToPath = (item) => `img/items/${item}.png`;\nexport const itemToInt = (item) => (item === \"rubs\" ? 99 : ITEMS.indexOf(item));\nexport const intToItem = (i) => (i === 99 ? \"rubs\" : ITEMS[i]);\nexport const sum = (previousValue, currentValue)  => (previousValue + currentValue);\n\n// Reference: https://stackoverflow.com/a/11381730\nexport const mobileAndTabletCheck = () => {\n    let check = false;\n    //eslint-disable-next-line\n    (function(a){if(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);\n    return check;\n};","import React, { useRef, useEffect, useState, useCallback } from 'react';\nimport { Tag, ProgressBar, Toaster, Position, Intent } from \"@blueprintjs/core\";\nimport PubSub from 'pubsub-js';\nimport { json as d3_json } from 'd3-fetch';\nimport { Stage, Container, Sprite } from '@inlet/react-pixi';\nimport range from 'lodash/range';\nimport debounce from 'lodash/debounce';\nimport clamp from 'lodash/clamp';\nimport { itemToPath, itemToInt, intToItem, sum, mobileAndTabletCheck } from './utils';\nimport { ITEMS, HAND_PLACING, EVENT_LOAD, GRID_WIDTH, GRID_HEIGHT, \n    AR, HTTP_URL, ITEM_MASK, RUB_MASK, TIME_LIMIT } from './constants';\n\nfunction HandSprites(props) {\n    const { arr, width, height, mask } = props;\n    \n    const item = 'raised-hand-emoji';\n    const logScaleAlpha = true;\n    const opacity = 0.5;\n    const scale = 1;\n\n    if(!arr || !mask) {\n        return [];\n    }\n    const xi = width / GRID_WIDTH;\n    const yi = height / GRID_HEIGHT;\n\n    const itemSize = scale*width/20;\n    const itemPath = itemToPath(item);\n\n    return Array.from(arr).map((count, iMask) => {\n        const iFlat = mask[iMask];\n        const j = Math.floor(iFlat / GRID_WIDTH);\n        const i = iFlat % GRID_WIDTH;\n        if(count === 0) {\n            return null;\n        }\n        if(logScaleAlpha) {\n            count = Math.log10(count+1);\n        }\n        const alpha = clamp(opacity*count, 0, 1);\n        return (\n            <Sprite\n                key={`${item}-${iMask}`}\n                image={itemPath}\n                x={i*xi}\n                y={j*yi}\n                width={itemSize}\n                height={itemSize}\n                alpha={alpha}\n            />\n        );\n    }).filter(Boolean);\n}\n\nfunction DonationSprites(props) {\n    const { data, width, height, mask } = props;\n    const logScaleAlpha = false;\n    const opacity = 1;\n    const scale = 2;\n\n    if(!data || !mask) {\n        return [];\n    }\n    const xi = width / GRID_WIDTH;\n    const yi = height / GRID_HEIGHT;\n\n    const itemSize = scale*width/20;\n\n    return range(ITEM_MASK.length).map((iMask) => {\n        const iFlat = mask[iMask];\n        const j = Math.floor(iFlat / GRID_WIDTH);\n        const i = iFlat % GRID_WIDTH;\n\n        const counts = ITEMS.map((item) => {\n            if(item === \"rubs\" || !data[item] || data[item][iMask] === 0) {\n                return null;\n            }\n            return [item, data[item][iMask]];\n        }).filter(Boolean).sort((a, b) => (a[1] - b[1]));\n\n        return counts.map(([item, count]) => {\n            const itemPath = itemToPath(item);\n\n            if(logScaleAlpha) {\n                count = Math.log10(count+1);\n            }\n            const alpha = clamp(opacity*count, 0, 1);\n            return (\n                <Sprite\n                    key={`${item}-${iMask}`}\n                    image={itemPath}\n                    x={i*xi}\n                    y={j*yi}\n                    width={itemSize}\n                    height={itemSize}\n                    alpha={alpha}\n                />\n            );\n        });\n    });\n}\n\nexport default function TestudoCanvas(props) {\n    const { handState, item } = props;\n    const isPlacing = (handState === HAND_PLACING && item);\n    const divRef = useRef();\n    const [width, setWidth] = useState(null);\n    const [height, setHeight] = useState(null);\n    const [top, setTop] = useState(0);\n    const [left, setLeft] = useState(0);\n    const [data, setData] = useState({});\n    const [rubTotal, setRubTotal] = useState(0);\n    const [itemTotals, setItemTotals] = useState({});\n    const [secondsRemaining, setSecondsRemaining] = useState(0);\n\n    useEffect(() => {\n        const token = PubSub.subscribe(EVENT_LOAD, (msg, arr) => {\n            const i = arr[0];\n            const item = intToItem(i);\n            const data = arr.subarray(1);\n\n            // Store the new array.\n            setData(prevData => ({ ...prevData, [item]: data }));\n\n            // Compute sum.\n            const total = data.reduce(sum, 0);\n            if(item === \"rubs\") {\n                setRubTotal(total);\n            } else {\n                setItemTotals(prevTotals => ({ ...prevTotals, [item]: total }));\n            }\n        });\n        return () => PubSub.unsubscribe(token);\n    }, []);\n\n    useEffect(() => {\n        const resizeHandler = () => {\n            const { width: divWidth, top: divTop, left: divLeft } = divRef.current.getBoundingClientRect();\n            setWidth(divWidth);\n            setHeight(divWidth/AR);\n            setTop(divTop);\n            setLeft(divLeft);\n        }\n        resizeHandler();\n        window.addEventListener('resize', resizeHandler);\n        return () => window.removeEventListener('resize', resizeHandler);\n    }, []);\n\n    useEffect(() => {\n        if(secondsRemaining > 0) {\n            setTimeout(() => setSecondsRemaining(oldVal => oldVal - 0.25), 250);\n        }\n    }, [secondsRemaining])\n\n    const onPointerDown = useCallback(debounce((event) => {\n        const origEvent = event.data.originalEvent;\n        const toast = Toaster.create({position: Position.TOP }, document.body);\n        if(origEvent) {\n            if(secondsRemaining) {\n                toast.show({ message: `Please wait ${TIME_LIMIT} seconds between rubs and donations.` });\n                return;\n            }\n            const itemSize = 2*width/20;\n\n            const clientX = (origEvent.clientX ? origEvent.clientX : origEvent.pageX);\n            const clientY = (origEvent.clientY ? origEvent.clientY : origEvent.pageY);\n            \n            const desktopOffset = (isPlacing ? - itemSize/2 : itemSize/2);\n            const isMobile = mobileAndTabletCheck();\n            \n            const x = clientX - left + (isMobile ? 0 : desktopOffset);\n            const y = clientY - top + (isMobile ? 0 : desktopOffset);\n\n            const xi = width / GRID_WIDTH;\n            const yi = height / GRID_HEIGHT;\n\n            const j = clamp(Math.round(x / xi), 0, GRID_WIDTH);\n            const i = clamp(Math.round(y / yi), 0, GRID_HEIGHT);\n            let iFlat = GRID_WIDTH*i + j;\n\n            const itemIndex = itemToInt(item);\n\n            let iMask;\n\n            if(item === \"rubs\") {\n                iMask = RUB_MASK.indexOf(iFlat);\n                if(iMask < 0) {\n                    toast.show({ message: \"You rubbed a donation or the air. Please only rub Testudo.\" });\n                    return;\n                }\n            } else {\n                iMask = ITEM_MASK.indexOf(iFlat);\n                if(iMask < 0) {\n                    toast.show({ message: \"Please place donations around Testudo, not on top or in the air.\" });\n                    return;\n                }\n            }\n\n            const req = {\n                item: itemIndex,\n                i: iMask,\n            };\n            d3_json(\n                HTTP_URL + '/incr',\n                { method: \"POST\", body: JSON.stringify(req) }\n            );\n            setSecondsRemaining(TIME_LIMIT);\n\n            toast.show({ message: `Testudo thanks you for the ${item}.`, intent: Intent.SUCCESS });\n        }\n    }, 500, { leading: true }), [top, left, item, width, height, secondsRemaining]);\n\n\n    const cursorStyle = (isPlacing ? \n        { cursor: `crosshair` } : \n        { cursor: `url('img/raised-hand-emoji.png'), auto` }\n    );\n\n    const donationTotal = Object.values(itemTotals).reduce(sum, 0);\n    const numberFormatter = new Intl.NumberFormat('en-US');\n\n    return (\n        <div ref={divRef} className=\"testudo-canvas-wrapper\">\n            <div style={{ width: `${width}px`, height: `${height}px`, ...cursorStyle }}>\n            <Stage\n                width={width}\n                height={height}\n                options={{\n                    transparent: true,\n                    antialias: true,\n                    resolution: 1,\n                    clearBeforeRender: true\n                }}\n            >\n                <Sprite\n                    image=\"/img/testudo.JPG\"\n                    x={0}\n                    y={0}\n                    width={width}\n                    height={height}\n                    interactive\n                    pointerdown={onPointerDown}\n                />\n                <Container>\n                    <HandSprites arr={data.rubs} width={width} height={height} mask={RUB_MASK} />\n                    <DonationSprites data={data} width={width} height={height} mask={ITEM_MASK} />\n                </Container>\n            </Stage>\n            </div>\n            <div className=\"footer\">\n                <p><Tag>rubs</Tag> <Tag minimal>{numberFormatter.format(rubTotal)}</Tag></p>\n                <p><Tag>donations</Tag> <Tag minimal>{numberFormatter.format(donationTotal)}</Tag></p>\n            </div>\n            {secondsRemaining > 0 ? (<ProgressBar value={1 - secondsRemaining / TIME_LIMIT} />) : null}\n            \n        </div>\n    );\n}\n","import React from 'react';\nimport { Classes } from \"@blueprintjs/core\";\nimport { itemToPath } from './utils';\nimport { ITEMS } from './constants';\n\n\nexport default function ItemList(props) {\n    const { onSelect } = props;\n\n    return (\n        <div className={Classes.DRAWER_BODY}>\n            <div className=\"item-list\">\n                {ITEMS.map((item) => (\n                    <div\n                        key={item}\n                        className=\"item\"\n                        style={{backgroundImage: `url('${itemToPath(item)}')`}}\n                        onClick={() => onSelect(item)}\n                    />\n                ))}\n            </div>\n        </div>\n    );\n}","import React, { useState, useEffect } from 'react';\nimport PubSub from 'pubsub-js';\nimport { Button, ButtonGroup, AnchorButton, Drawer, Position, Tooltip } from \"@blueprintjs/core\";\nimport { IconNames } from \"@blueprintjs/icons\";\nimport TestudoCanvas from './TestudoCanvas';\nimport ItemList from './ItemList';\n\nimport { HAND_RUBBING, HAND_PLACING, WS_URL, EVENT_LOAD } from './constants';\n\nfunction App() {\n\n  const [handState, setHandState] = useState(HAND_RUBBING);\n  const [isPicking, setIsPicking] = useState(false);\n  const [item, setItem] = useState(null);\n\n  useEffect(() => {\n    const socket = new WebSocket(WS_URL + '/rub-or-donate');\n\n    // Connection opened\n    socket.addEventListener('open', () => {\n        socket.send(JSON.stringify({\"type\": \"init\"}));\n    });\n\n    // Listen for messages\n    socket.addEventListener('message', (msg) => {\n        const blob = msg.data;\n\n        try {\n            blob.arrayBuffer().then((buf) => {\n                const arr = new Uint16Array(buf);\n                PubSub.publish(EVENT_LOAD, arr);\n            });\n        } catch(e) {\n            const fileReader = new FileReader();\n            fileReader.onload = (event) => {\n                const buf = event.target.result;\n                if(buf) {\n                    const arr = new Uint16Array(buf);\n                    PubSub.publish(EVENT_LOAD, arr);\n                }\n            };\n            fileReader.readAsArrayBuffer(blob);\n        }\n    });\n\n    // Connection closed\n    socket.addEventListener('close', (msg) => {\n        console.log('Closed websocket connection', msg);\n    });\n  }, []);\n\n  const onSelectItem = (name) => {\n    setIsPicking(false);\n    setItem(name);\n    setHandState(HAND_PLACING);\n  };\n\n  return (\n    <div className=\"app\">\n      <div className=\"header\">\n        <div className=\"header-left\">\n\n          <ButtonGroup>\n            <Tooltip content=\"Click to rub Testudo\" position={Position.BOTTOM} hoverOpenDelay={20}>\n                <Button large text=\"✋ Rub\" active={handState === HAND_RUBBING} onClick={() => setHandState(HAND_RUBBING)}/>\n            </Tooltip>\n            <Tooltip content=\"Select an item and click to place around Testudo\" position={Position.BOTTOM} hoverOpenDelay={20}>\n                <Button large text=\"👇 Donate item\" active={handState === HAND_PLACING} onClick={() => setIsPicking(true)}/>\n            </Tooltip>\n          </ButtonGroup>\n        </div>\n        <div className=\"header-right\">\n          <AnchorButton text=\"The original\" href=\"https://ellielitwack.github.io/testudosimulator/\" rightIcon={IconNames.SHARE} />\n          <AnchorButton text=\"Contribute\" href=\"https://github.com/keller-mark/testudo-collabo\" rightIcon={IconNames.CODE} />\n        </div>\n      </div>\n      <div className=\"background\">\n        <TestudoCanvas handState={handState} item={(handState === HAND_PLACING ? item : \"rubs\")} />\n      </div>\n\n      <Drawer\n        isOpen={isPicking}\n        onClose={() => setIsPicking(false)}\n        title=\"Select item to donate\"\n        lazy={false}\n      >\n        <ItemList\n          onSelect={onSelectItem}\n        />\n      </Drawer>\n      <img alt=\"testudo\" src=\"img/icon.png\" style={{display: 'none'}} />\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport './index.scss';\n\nReactDOM.render(\n  <App />,\n  document.getElementById('root')\n);"],"sourceRoot":""}